from .generic import Probe
import pyaudio

class AudioProbe(Probe):
	def __init__(self):
		# audio setup
		self.CHUNK = 8192    # input buffer size in frames
		self.FORMAT = pyaudio.paInt16
		self.CHANNELS = 2
		self.RATE = 48000    # depends on sound card: 96000 might be possible
		self.p = None

	def open(self):
		# open sound card data stream
		self.p = pyaudio.PyAudio()
		self.stream = p.open(format=self.FORMAT,
				channels=self.CHANNELS,
				rate=self.RATE,
				input=True,
				frames_per_buffer=self.CHUNK)

	def read(self, channel, npoints):
		nchunks = int(npoints/self.CHUNK) + 1*(npoints % self.CHUNK > 0)
		return stream.read(nchunks)[channel]

	def close(self):
		self.stream.stop_stream()
		self.stream.close()
		self.p.terminate()

